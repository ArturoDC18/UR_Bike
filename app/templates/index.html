{% extends "base.html" %}

{% block main %}
<div class="map-container">
    <div id="map"></div>
</div>
{% endblock %}

{% block scripts %}
<script>
mapboxgl.accessToken = 'pk.eyJ1IjoicGhhcmkiLCJhIjoiY20za2oza2twMGZ0ZTJpcHd4bm1rNnZsYSJ9.aTw69jaVO9sD3m81sMObfg';

document.addEventListener("DOMContentLoaded", () => {
  const map = new mapboxgl.Map({
    container: 'map', // ID of the container
    style: 'mapbox://styles/mapbox/navigation-guidance-day-v4', // Map style
    center: [-77.6298, 43.1286], // University of Rochester coordinates
    zoom: 16.4, // Initial zoom level
    pitch: 0,
    bearing: 0,
    antialias: true
  });


  const nav = new mapboxgl.NavigationControl();
  map.addControl(nav);

//   //adding directions
// var mapboxgl = require('mapbox-gl');
// var MapboxDirections = require('@mapbox/mapbox-gl-directions');

// var directions = new MapboxDirections({
//   accessToken: 'pk.eyJ1IjoicGhhcmkiLCJhIjoiY20za2oza2twMGZ0ZTJpcHd4bm1rNnZsYSJ9.aTw69jaVO9sD3m81sMObfg',
// });


// map.addControl(directions, 'top-left');

// Adding directions without require statements
var directions = new MapboxDirections({
  accessToken: 'pk.eyJ1IjoicGhhcmkiLCJhIjoiY20za2oza2twMGZ0ZTJpcHd4bm1rNnZsYSJ9.aTw69jaVO9sD3m81sMObfg',
  profile: 'mapbox/cycling',
  controls: {
    inputs: true,           // Show or hide the origin and destination inputs
    profileSwitcher: false, // Disable profile switching
    instructions: false     // Hide turn-by-turn instructions
  }
});

map.addControl(directions, 'top-left');



// Add 3D buildings
map.on('load', () => {
  map.addLayer({
    'id': '3d-buildings',
    'source': 'composite',
    'source-layer': 'building',
    'filter': ['==', 'extrude', 'true'],
    'type': 'fill-extrusion',
    'minzoom': 15,
    'paint': {
      'fill-extrusion-color': '#aaa',
      'fill-extrusion-height': [
        'interpolate',
        ['linear'],
        ['zoom'],
        15,
        0,
        15.05,
        ['get', 'height']
      ],
      'fill-extrusion-base': [
        'interpolate',
        ['linear'],
        ['zoom'],
        15,
        0,
        15.05,
        ['get', 'min_height']
      ],
      'fill-extrusion-opacity': 0.6
    }
  });
});

  // Add bike rack markers
  const bikeRacks = [
    { coordinates: [-77.629503, 43.128123], name: "Rush Rhees Library Bike Rack" },
    { coordinates: [-77.626684, 43.129515], name: "Sue B"},    // Add more bike rack locations as needed
  ];

  bikeRacks.forEach(rack => {
  // Create a marker element with the bike rack image
  const el = document.createElement('div');
  el.className = 'bike-rack-marker';

  // Add marker to map
  new mapboxgl.Marker(el)
    .setLngLat(rack.coordinates)
    .setPopup(new mapboxgl.Popup().setHTML(rack.name)) // Add a popup if needed
    .addTo(map);
});
});



</script>

{% endblock %}
